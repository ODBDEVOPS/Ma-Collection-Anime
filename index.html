<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ma Collection Anime</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
    body { margin:0; background:#0d0d1a; color:#eee; font-family:'Poppins',sans-serif; }
    header { text-align:center; padding:50px 20px; background:linear-gradient(135deg,#1e1e3d,#2a1e3d); }
    h1 { margin:0; font-size:3em; color:#00d4ff; }
    .count { color:#aaa; margin-top:10px; }
    .gallery { 
      display:grid; 
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); 
      gap:30px; padding:40px; max-width:1600px; margin:0 auto;
    }
    .card { 
      background:#1a1a2e; border-radius:16px; overflow:hidden; cursor:pointer;
      transition:0.3s; position:relative;
    }
    .card:hover { transform:scale(1.05); box-shadow:0 20px 40px rgba(0,212,255,0.3); }
    .card img { width:100%; height:400px; object-fit:cover; }
    .info { padding:16px; }
    .title { font-size:1.35em; margin:0 0 8px; color:#00d4ff; }
    .meta { display:flex; flex-wrap:wrap; gap:8px; font-size:0.85em; }
    .tag { background:#16213e; padding:4px 10px; border-radius:20px; }
    .note { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.7); color:#ffd700; padding:6px 12px; border-radius:20px; font-weight:bold; }
    .status { position:absolute; top:10px; left:10px; background:#ff2e63; padding:4px 10px; border-radius:20px; font-size:0.8em; }
  </style>
</head>
<body>
  <header>
    <h1>Ma Collection Anime</h1>
    <div class="count">Chargement...</div>
  </header>

  <div class="gallery" id="gallery"></div>

  <script>
    const files = [
      "one-piece.json","anime-aot.json","anime-fmab.json","anime-demon-slayer.json","solo-leveling.json",
      "anime-deathnote.json","anime-naruto.json","anime-jujutsukaisen.json","anime-chainsawman.json"
    ];

    const gallery = document.getElementById('gallery');
    const countEl = document.querySelector('.count');

    Promise.all(files.map(f => fetch(f).then(r => r.ok ? r.json() : null).catch(()=>null)))
      .then(animes => {
        const valid = animes.filter(Boolean);
        countEl.textContent = `${valid.length} anime${valid.length>1?'s':''} dans la collection`;

        valid.sort((a,b) => (b.note_personnelle||b.note_moyenne||0) - (a.note_personnelle||a.note_moyenne||0));

        gallery.innerHTML = valid.map(a => `
          <div class="card" onclick="openDetail('${a.id || a.titre.toLowerCase().replace(/[^a-z0-9]/g,'-')}.json')">
            ${a.note_personnelle||a.note_moyenne ? `<div class="note">★ ${a.note_personnelle||a.note_moyenne}</div>` : ''}
            ${a.statut==="En cours" ? `<div class="status">EN COURS</div>` : ''}
            <img src="${a.images?.affiche || a.images?.miniature || 'https://via.placeholder.com/300x420/1a1a2e/00d4ff?text=No+Image'}" 
                 alt="${a.titre}" loading="lazy">
            <div class="info">
              <div class="title">${a.titre} ${a.favori?'❤️':''}</div>
              <div class="meta">
                <span class="tag">${a.annee_diffusion||'?'}</span>
                <span class="tag">${a.nb_episodes||'?'}${(a.nb_episodes?' ép.':'')}</span>
                ${a.genres?.slice(0,3).map(g=>`<span class="tag">${g}</span>`).join('')||''}
              </div>
            </div>
          </div>
        `).join('');
      });

    function openDetail(filename) {
      window.location.href = `detail.html?anime=${filename}`;
    }
  </script>
</body>
</html>
